---
import type { Vod } from "@lib/types";
import formatTimeAgo from "@lib/utils/formatTimeAgo";

const formatter = new Intl.RelativeTimeFormat(Astro.currentLocale, {
  numeric: "auto",
});

const response = await fetch("https://beta.zvods.com/api/vods/recentvods", {
  mode: "cors",
});

const vods = (await response.json()) as Vod[];
---

<section id="recentVods" class="flex-1 flex gap-2 flex-wrap px-3 py-3">
  {
    vods.map((vod, index) => (
      <div class="w-fit min-h-64 border-blue-500 bg-black h-full box-border rounded-md">
        <a href="#">
          <img
            class="w-80 p-1 rounded-xl"
            src={`https://i.ytimg.com/vi_webp/${vod.vodId.split(",")[0]}/hqdefault.webp`}
          />
          <div class="info flex px-3 py-1 gap-2">
            <img
              class="h-8 object-contain rounded-full"
              src="https://raw.githubusercontent.com/zVodsChannel/images/main/assets/Streamers/Yayahuz/AvatarImage/yayahuz-avatar.webp"
            />
            <div class="grid text-start w-full break-word">
              <span class="text-[0.8rem] text-ellipsis font-bold">
                {vod.title}
              </span>
              <a href="#" class="text-xs font-sans font-normal">
                {vod.channel}
              </a>
              <span class="text-xs w-full font-light text-right -mt-3">
                {formatTimeAgo(vod.date, formatter)}
              </span>
            </div>
          </div>
        </a>
      </div>
    ))
  }
</section>
