---
import formatTimeAgo from '@lib/utils/formatTimeAgo'

const formatter = new Intl.RelativeTimeFormat(Astro.currentLocale, { numeric: 'auto' })
---

<section id="recentVods" class="flex-1 flex gap-2 flex-wrap px-3 py-3">
  <!-- <div class="w-fit min-h-64 border-blue-500 bg-black h-full box-border rounded-md">
    <a href="#">
      <img class="w-80 p-1 rounded-xl" src={`https://i.ytimg.com/vi_webp/${vod.vodId}/hqdefault.webp`} />
      <div class="info flex px-3 py-1 gap-2">
        <img class="h-8 object-contain rounded-full" src="https://raw.githubusercontent.com/zVodsChannel/images/main/assets/Streamers/Yayahuz/AvatarImage/yayahuz-avatar.webp" />
        <div class="grid text-start w-full break-word">
          <span class="text-[0.8rem] text-ellipsis font-bold">{vod.title}</span>
          <a href="#" class="text-xs font-sans font-normal">
            {vod.channel}
          </a>
          <span class="text-xs w-full font-light text-right -mt-3">{formatTimeAgo(vod.date, formatter)}</span>
        </div>
      </div>
    </a>
  </div> -->
</section>

<script>
  import { getLangFromUrl } from '@lib/i18n/utils'
  import formatTimeAgo from '@lib/utils/formatTimeAgo'
  import type { Vod } from '@lib/types'
  const formatter = new Intl.RelativeTimeFormat(getLangFromUrl({ ...location }), { numeric: 'auto' })

  async function fetchVods() {
    const response = await fetch('https://beta.zvods.com/api/vods/recentvods', {
      mode: 'cors',
    })

    const vods = (await response.json()) as Vod[]
    const vodContainer = document.getElementById('recentVods') as HTMLDivElement

    vods.forEach((vod, i) => {
      const vodDiv = document.createElement('div')
      vodDiv.className = 'w-fit min-h-64 border-blue-500 bg-black h-full box-border rounded-md'

      const aVodLink = document.createElement('a')
      aVodLink.href = '#'

      const imgThumbnail = document.createElement('img')
      imgThumbnail.className = 'w-80 p-1 rounded-xl'
      imgThumbnail.src = `https://i.ytimg.com/vi_webp/${vod.vodId.split(',')[0]}/hqdefault.webp`

      const infoDiv = document.createElement('div')
      infoDiv.className = 'info flex px-3 py-1 gap-2'

      const avatarImg = document.createElement('img')
      avatarImg.className = 'h-8 object-contain rounded-full'
      avatarImg.src = 'https://raw.githubusercontent.com/zVodsChannel/images/main/assets/Streamers/Yayahuz/AvatarImage/yayahuz-avatar.webp'

      const textDiv = document.createElement('div')
      textDiv.className = 'grid text-start w-full break-word'

      const titleSpan = document.createElement('span')
      titleSpan.className = 'text-[0.8rem] text-ellipsis font-bold'
      titleSpan.textContent = vod.title

      const channelLink = document.createElement('a')
      channelLink.className = 'text-xs font-sans font-normal'
      channelLink.href = '#'
      channelLink.textContent = vod.channel

      const dateSpan = document.createElement('span')
      dateSpan.className = 'text-xs w-full font-light text-right -mt-3'
      dateSpan.textContent = formatTimeAgo(vod.date, formatter)!

      textDiv.appendChild(titleSpan)
      textDiv.appendChild(channelLink)
      textDiv.appendChild(dateSpan)

      infoDiv.appendChild(avatarImg)
      infoDiv.appendChild(textDiv)

      aVodLink.appendChild(imgThumbnail)
      aVodLink.appendChild(infoDiv)

      vodDiv.appendChild(aVodLink)
      if (i === 0) vodContainer.innerHTML = ''
      vodContainer.appendChild(vodDiv)
    })
  }
  fetchVods()
</script>
